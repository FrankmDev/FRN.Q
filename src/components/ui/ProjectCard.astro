---
import { padNumber } from "../../utils";

interface Props {
  title: string;
  category: string;
  year: string;
  index: number;
  tech: string[];
}

const { title, category, year, index, tech } = Astro.props;
const formattedIndex = padNumber(index + 1);
---

<article
  class="project-card group relative cursor-none border-b border-foreground/20 hover:border-white/40 transition-colors duration-500"
  data-index={index}
  data-project-card
  data-cursor="VIEW"
>
  {/* Minimal Background - only on hover */}
  <div 
    class="absolute inset-0 bg-white -z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-500"
  ></div>

  {/* Main Content */}
  <div class="relative py-10 md:py-14 px-6 md:px-10">
    
    <div class="grid grid-cols-12 gap-4 md:gap-6 items-end">
      
      {/* Index Column - Minimal */}
      <div class="col-span-2 md:col-span-1">
        <span 
          class="card-index font-mono text-[10px] tracking-[0.4em] text-foreground/40 group-hover:text-black transition-colors duration-500"
        >
          {formattedIndex}
        </span>
      </div>

      {/* Title Column - Massive & White */}
      <div class="col-span-10 md:col-span-9">
        {/* Category */}
        <div class="mb-2 flex items-center gap-2">
          <span class="font-mono text-[10px] tracking-[0.4em] uppercase text-foreground/50 group-hover:text-black/60 transition-colors duration-500">
            {category}
          </span>
          <span class="flex-1 h-px bg-foreground/10 group-hover:bg-black/10 transition-colors duration-500 max-w-[60px]"></span>
        </div>

        {/* Main Title - WHITE */}
        <h3 
          class="card-title text-[2.5rem] sm:text-[3rem] md:text-[4rem] lg:text-[6rem] xl:text-[7rem] font-black uppercase leading-[0.8] tracking-[-0.04em] text-white group-hover:text-black transition-colors duration-500"
        >
          {title}
        </h3>
        
        {/* Year */}
        <div class="mt-3 flex items-center gap-3">
          <span class="font-mono text-sm tracking-widest text-foreground/50 group-hover:text-black/70 transition-colors duration-500">
            {year}
          </span>
        </div>
      </div>

      {/* Tech & Arrow Column */}
      <div class="col-span-12 md:col-span-2 flex flex-row md:flex-col items-end justify-between gap-4">
        {/* Tech Tags - Minimal */}
        <div class="flex flex-wrap justify-end gap-2">
          {tech.map((item) => (
            <span 
              class="font-mono text-[9px] tracking-[0.15em] uppercase text-foreground/40 group-hover:text-black/60 transition-colors duration-500"
            >
              {item}
            </span>
          ))}
        </div>
        
        {/* Arrow */}
        <div class="view-arrow w-8 h-8 border border-foreground/30 group-hover:border-black group-hover:bg-black flex items-center justify-center transition-all duration-300">
          <svg 
            class="w-3 h-3 text-foreground/60 group-hover:text-white transition-colors duration-300" 
            fill="none" 
            stroke="currentColor" 
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 17L17 7M17 7H7M17 7V17"></path>
          </svg>
        </div>
      </div>
    </div>
  </div>

  {/* Simple bottom line indicator */}
  <div class="absolute bottom-0 left-0 h-[2px] bg-white w-0 group-hover:w-full transition-all duration-500 ease-out"></div>
</article>

<style>
  .project-card {
    will-change: transform;
    background: transparent;
  }

  .card-title {
    font-feature-settings: "kern" 1;
    text-rendering: optimizeLegibility;
  }

  /* Selection styling */
  .project-card ::selection {
    background: white;
    color: black;
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const triggers: ScrollTrigger[] = [];

  function initCards() {
    const cards = gsap.utils.toArray<HTMLElement>("[data-project-card]");
    
    cards.forEach((card, index) => {
      const title = card.querySelector(".card-title") as HTMLElement;
      const indexNum = card.querySelector(".card-index") as HTMLElement;
      const viewArrow = card.querySelector(".view-arrow") as HTMLElement;

      // Entry animation - minimal
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: card,
          start: "top 85%",
          toggleActions: "play none none none",
        },
      });

      if (tl.scrollTrigger) {
        triggers.push(tl.scrollTrigger);
      }

      // Initial states
      gsap.set(card, { opacity: 0, y: 40 });
      gsap.set(indexNum, { opacity: 0 });
      gsap.set(title, { opacity: 0, y: 30 });

      // Card entrance
      tl.to(card, {
        opacity: 1,
        y: 0,
        duration: 0.8,
        ease: "power3.out",
      }, 0);

      // Index
      tl.to(indexNum, {
        opacity: 1,
        duration: 0.5,
        ease: "power2.out",
      }, 0.2);

      // Title
      tl.to(title, {
        opacity: 1,
        y: 0,
        duration: 0.7,
        ease: "power3.out",
      }, 0.1 + index * 0.05);

      // HOVER - Minimal shift
      card.addEventListener("mouseenter", () => {
        if (title) {
          gsap.to(title, {
            x: 10,
            duration: 0.3,
            ease: "power2.out",
          });
        }
      });

      card.addEventListener("mouseleave", () => {
        if (title) {
          gsap.to(title, {
            x: 0,
            duration: 0.3,
            ease: "power2.out",
          });
        }
      });
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initCards);
  } else {
    initCards();
  }

  document.addEventListener("astro:before-swap", () => {
    triggers.forEach((trigger) => trigger.kill());
  });
</script>
